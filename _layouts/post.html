---
layout: default
---

{% comment %} navbar removed on post pages {% endcomment %}

<article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting" id="main" role="article" aria-label="Content">

  <!-- The logo is now a direct grid item -->
  <div class="post-logo-left">
    <a href="{{ '/' | relative_url }}">
      <img src="{{ '/assets/images/carruc-eu-logo-inline.png' | relative_url }}" alt="carruc.eu logo inline">
    </a>
  </div>

  <!-- The table of contents is also a direct grid item -->
  <aside class="post-toc-left">
    <nav class="toc" aria-label="Table of contents">
      <div class="toc-title">Table of Contents:</div>
      <ul class="toc-list"></ul>
    </nav>
  </aside>

  <nav class="menu">
    <ul>
      {% for item in site.data.menu %}
          <a href="{{ item.url | relative_url }}">{{ item.title }}</a>
      {% endfor %}
    </ul>
  </nav>

  {% if page.title != "" %}
    <h1 class="post-title p-name" itemprop="name headline">
      {{ page.title }}
    </h1>
  {% endif %}

  <!-- Create a single container for the intro and the body -->
  <div class="article-body-container">
    {% if page.intro %}
      <p class="intro">{{ page.intro }}</p>
    {% endif %}

    <div class="post-content e-content" itemprop="articleBody">
      {{ content }}
    </div>

    <!-- ADD THE BIBLIOGRAPHY COMPONENT HERE -->
    {% if page.bibliography %}
      <section class="bibliography">
        <h3 class="bibliography-title">Bibliography</h3>
        <!-- CHANGE this from <ol> to <ul> -->
        <ul class="bibliography-list">
          {% for item in page.bibliography %}
            <li><a href="{{ item.url }}" target="_blank" rel="noopener">{{ item.name }}</a></li>
          {% endfor %}
        </ul>
      </section>
    {% endif %}
    <!-- END BIBLIOGRAPHY COMPONENT -->
  </div>

  <div class="post-meta">
    {% if page.author %}
      <div itemprop="author">{{ page.author }}</div>
    {% endif %}
    <time class="post-date dt-published" datetime="{{ page.date | date_to_xmlschema }}" itemprop="datePublished">{{ page.date | date: "%B %-d, %Y" }}</time>
  </div>

  {% if site.disqus.shortname %}
    {% include disqus-comments.html %}
  {% endif %}

</article>

<script>
  (function() {
    // This selector is now corrected to find the content inside the new container.
    var content = document.querySelector('.post .article-body-container .post-content');
    var list = document.querySelector('.post .post-toc-left .toc-list');
    
    // The rest of the script is the same, but it will now work.
    if (!content || !list) return;
  
    var headings = content.querySelectorAll('h1, h2, h3');
    if (!headings.length) return;
  
    function slugify(text){
      return text.toLowerCase().trim().replace(/[^a-z0-9\s-]/g,'').replace(/\s+/g,'-').replace(/-+/g,'-');
    }
  
    headings.forEach(function(h){
      var level = parseInt(h.tagName.substr(1), 10);
      if (level < 1 || level > 3) return;
  
      if (!h.id) {
        h.id = slugify(h.textContent || h.innerText || 'section');
      }
  
      var li = document.createElement('li');
      li.className = 'toc-level-' + level;
      var a = document.createElement('a');
      a.href = '#' + h.id;
      a.textContent = h.textContent || h.innerText || '';
      li.appendChild(a);
      list.appendChild(li);
    });
  })();
</script>
  
<!-- Final, Corrected Sidenote Script -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const contentContainer = document.querySelector('.article-body-container');
    if (!contentContainer) return;
  
    const footnoteContainer = document.querySelector('.footnotes');
    if (!footnoteContainer) return;
  
    // Find all footnote references in the text
    const footnoteReferences = Array.from(contentContainer.querySelectorAll('a[href^="#fn:"]'));
  
    footnoteReferences.forEach(refLink => {
      const footnoteId = refLink.getAttribute('href').substring(1);
      const footnoteContentElement = document.getElementById(footnoteId);
  
      if (footnoteContentElement) {
        // --- NEW LOGIC STARTS HERE ---

        // 1. Get the footnote number from the link's text content.
        const footnoteNumber = refLink.textContent;
        const numberText = `${footnoteNumber}. `;

        // 2. Remove the back-arrow link from the footnote definition.
        const backlink = footnoteContentElement.querySelector('a[href^="#fnref:"]');
        if (backlink) {
          backlink.remove();
        }

        // 3. Prepend the number to the content.
        // This checks if the footnote content is wrapped in a <p> tag.
        const firstParagraph = footnoteContentElement.querySelector('p');
        if (firstParagraph) {
          // If it is, insert the number inside the paragraph to avoid a line break.
          firstParagraph.innerHTML = numberText + firstParagraph.innerHTML;
        } else {
          // Otherwise, just prepend it to the whole content.
          footnoteContentElement.innerHTML = numberText + footnoteContentElement.innerHTML;
        }

        // --- NEW LOGIC ENDS HERE ---

        // Create the sidenote element
        const sidenote = document.createElement('aside');
        sidenote.className = 'sidenote';
        sidenote.setAttribute('data-sidenote-for', footnoteId);
        
        // Use the modified content that now includes the number
        sidenote.innerHTML = footnoteContentElement.innerHTML;
        
        // Get the position of the footnote reference
        const refPosition = refLink.getBoundingClientRect();
        const containerPosition = contentContainer.getBoundingClientRect();
  
        // Position the sidenote vertically aligned with the reference
        sidenote.style.position = 'absolute';
        sidenote.style.top = `${refPosition.top - containerPosition.top}px`;
        sidenote.style.left = '105%';
  
        contentContainer.appendChild(sidenote);
      }
    });
  
    // Hide the original footnote section at the bottom
    footnoteContainer.style.display = 'none';
  });
</script>

  